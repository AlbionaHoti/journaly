# Migration `20200317204944-build-out-schema`

This migration has been generated by Robin MacPherson at 3/17/2020, 8:49:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "UserRole" AS ENUM ('ADMIN', 'MODERATOR', 'FREE_USER', 'PRO_USER');

CREATE TYPE "PostStatus" AS ENUM ('DRAFT', 'PUBLISHED');

CREATE TYPE "SocialMediaPlatform" AS ENUM ('FACEBOOK', 'YOUTUBE', 'INSTAGRAM', 'LINKEDIN');

CREATE TABLE "public"."SocialMedia" (
    "Id" text  NOT NULL ,
    "platform" "SocialMediaPlatform" NOT NULL DEFAULT 'FACEBOOK',
    "url" text  NOT NULL DEFAULT '',
    "user" text   ,
    PRIMARY KEY ("Id")
)

CREATE TABLE "public"."Location" (
    "City" text  NOT NULL DEFAULT '',
    "Country" text  NOT NULL DEFAULT '',
    "Id" text  NOT NULL ,
    PRIMARY KEY ("Id")
)

CREATE TABLE "public"."Topic" (
    "Id" text  NOT NULL ,
    "Name" text  NOT NULL DEFAULT '',
    "user" text   ,
    PRIMARY KEY ("Id")
)

CREATE TABLE "public"."Like" (
    "CreatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "Id" text  NOT NULL ,
    "UpdatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "author" text  NOT NULL ,
    "post" text  NOT NULL ,
    PRIMARY KEY ("Id")
)

CREATE TABLE "public"."Comment" (
    "Body" text  NOT NULL DEFAULT '',
    "CreatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "Id" text  NOT NULL ,
    "Position" text  NOT NULL DEFAULT '',
    "UpdatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "author" text  NOT NULL ,
    "post" text  NOT NULL ,
    PRIMARY KEY ("Id")
)

CREATE TABLE "public"."Interest" (
    "Id" text  NOT NULL ,
    "Name" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("Id")
)

CREATE TABLE "public"."Language" (
    "Dialect" text   ,
    "Id" text  NOT NULL ,
    "Name" text  NOT NULL DEFAULT '',
    "learningUsers" text  NOT NULL ,
    "nativeUsers" text  NOT NULL ,
    PRIMARY KEY ("Id")
)

CREATE TABLE "public"."_PostToTopic" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL
)

ALTER TABLE "public"."Post" DROP CONSTRAINT IF EXiSTS "Post_author_fkey",
DROP COLUMN "Published",
ADD COLUMN "Latitude" Decimal(65,30)   ,
ADD COLUMN "Longitude" Decimal(65,30)   ,
ADD COLUMN "ReadCount" integer  NOT NULL DEFAULT 0,
ADD COLUMN "ReadTime" integer  NOT NULL DEFAULT 0,
ADD COLUMN "interest" text   ,
ADD COLUMN "language" text  NOT NULL ,
ADD COLUMN "status" "PostStatus" NOT NULL DEFAULT 'DRAFT';

ALTER TABLE "public"."User" DROP COLUMN "status",
ADD COLUMN "Bio" text   ,
ADD COLUMN "Handle" text  NOT NULL DEFAULT '',
ADD COLUMN "location" text   ,
ADD COLUMN "userRole" "UserRole" NOT NULL DEFAULT 'FREE_USER';

CREATE UNIQUE INDEX "_PostToTopic_AB_unique" ON "public"."_PostToTopic"("A","B")

CREATE  INDEX "_PostToTopic_B_index" ON "public"."_PostToTopic"("B")

CREATE UNIQUE INDEX "User.Handle" ON "public"."User"("Handle")

ALTER TABLE "public"."SocialMedia" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("Id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Topic" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("Id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Like" ADD FOREIGN KEY ("author")REFERENCES "public"."User"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Like" ADD FOREIGN KEY ("post")REFERENCES "public"."Post"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("author")REFERENCES "public"."User"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("post")REFERENCES "public"."Post"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Language" ADD FOREIGN KEY ("nativeUsers")REFERENCES "public"."User"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Language" ADD FOREIGN KEY ("learningUsers")REFERENCES "public"."User"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_PostToTopic" ADD FOREIGN KEY ("A")REFERENCES "public"."Post"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_PostToTopic" ADD FOREIGN KEY ("B")REFERENCES "public"."Topic"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("author")REFERENCES "public"."User"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("language")REFERENCES "public"."Language"("Id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("interest")REFERENCES "public"."Interest"("Id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("location")REFERENCES "public"."Location"("Id") ON DELETE SET NULL  ON UPDATE CASCADE

DROP TYPE "Status"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200229105108-init..20200317204944-build-out-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,37 +1,110 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator prisma_client {
   provider = "prisma-client-js"
 }
-enum Status {
-  ADMIN MODERATOR FREE_USER PRO_USER
+model User {
+  Id                String        @id @default(cuid())
+  Name              String
+  Email             String        @unique
+  Password          String
+  ResetToken        String?
+  ResetTokenExpiry  Float?
+  userRole          UserRole      @default(FREE_USER)
+  CreatedAt         DateTime      @default(now())
+  UpdatedAt         DateTime      @updatedAt
+  Handle            String        @unique
+  Bio               String?
+  socialMedia       SocialMedia[]
+  interests         Topic[]
+  location          Location?
+  languagesNative   Language[]    @relation("LanguageToNative")
+  languagesLearning Language[]    @relation("LanguageToLearner")
 }
-model User {
-  Id               String   @id @default(cuid())
-  Name             String
-  Email            String   @unique
-  Password         String
-  ResetToken       String?
-  ResetTokenExpiry Float?
-  status           Status[]
-  posts            Post[]
-  CreatedAt        DateTime @default(now())
-  UpdatedAt        DateTime @updatedAt
+model SocialMedia {
+  Id       String              @id @default(cuid())
+  platform SocialMediaPlatform
+  url      String
 }
 model Post {
-  Id         String   @id @default(cuid())
+  Id         String     @id @default(cuid())
   Title      String
   Body       String
-  Published  Boolean
+  status     PostStatus @default(DRAFT)
   Image      String?
   LargeImage String?
-  CreatedAt  DateTime @default(now())
-  UpdatedAt  DateTime @updatedAt
+  CreatedAt  DateTime   @default(now())
+  UpdatedAt  DateTime   @updatedAt
   author     User
+  ReadCount  Int        @default(0)
+  ReadTime   Int
+  likes      Like[]
+  comments   Comment[]
+  topic      Topic[]
+  language   Language
+  Longitude  Float?
+  Latitude   Float?
 }
+
+model Location {
+  Id      String @id @default(cuid())
+  Country String
+  City    String
+}
+
+model Topic {
+  Id    String @id @default(cuid())
+  Name  String
+  posts Post[]
+}
+
+model Like {
+  Id        String   @id @default(cuid())
+  CreatedAt DateTime @default(now())
+  UpdatedAt DateTime @updatedAt
+  author    User
+  post      Post
+}
+
+model Comment {
+  Id        String   @id @default(cuid())
+  CreatedAt DateTime @default(now())
+  UpdatedAt DateTime @updatedAt
+  Body      String
+  Position  String
+  author    User
+  post      Post
+}
+
+model Interest {
+  Id    String @id @default(cuid())
+  Name  String
+  posts Post[]
+}
+
+model Language {
+  Id            String  @id @default(cuid())
+  posts         Post[]
+  Name          String
+  Dialect       String?
+  nativeUsers   User    @relation("LanguageToNative")
+  learningUsers User    @relation("LanguageToLearner")
+}
+
+enum UserRole {
+  ADMIN MODERATOR FREE_USER PRO_USER
+}
+
+enum PostStatus {
+  DRAFT PUBLISHED
+}
+
+enum SocialMediaPlatform {
+  FACEBOOK YOUTUBE INSTAGRAM LINKEDIN
+}
```
