# Migration `20200702185801-fix-issues`

This migration has been generated by Robin MacPherson at 7/2/2020, 6:58:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."UserInterest" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"topicId" integer  NOT NULL ,"userId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."PostTopic" (
"id" SERIAL,"postId" integer  NOT NULL ,"topicId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Post" ALTER COLUMN "status" SET DEFAULT 'DRAFT';

ALTER TABLE "public"."User" ALTER COLUMN "userRole" SET DEFAULT 'FREE_USER';

ALTER TABLE "public"."PostTopics" DROP CONSTRAINT IF EXiSTS "PostTopics_postId_fkey";

ALTER TABLE "public"."PostTopics" DROP CONSTRAINT IF EXiSTS "PostTopics_topicId_fkey";

ALTER TABLE "public"."UserInterests" DROP CONSTRAINT IF EXiSTS "UserInterests_topicId_fkey";

ALTER TABLE "public"."UserInterests" DROP CONSTRAINT IF EXiSTS "UserInterests_userId_fkey";

CREATE UNIQUE INDEX "UserInterest.userId_topicId" ON "public"."UserInterest"("userId","topicId")

CREATE UNIQUE INDEX "PostTopic.postId_topicId" ON "public"."PostTopic"("postId","topicId")

ALTER TABLE "public"."UserInterest" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."UserInterest" ADD FOREIGN KEY ("topicId")REFERENCES "public"."Topic"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."PostTopic" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."PostTopic" ADD FOREIGN KEY ("topicId")REFERENCES "public"."Topic"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."PostTopics";

DROP TABLE "public"."UserInterests";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200625141833-remove-language-learning-unique-constraint-on-user-id..20200702185801-fix-issues
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator prisma_client {
   provider = "prisma-client-js"
@@ -24,9 +24,9 @@
   languagesNative   LanguageNative[]
   languagesLearning LanguageLearning[]
   createdAt         DateTime           @default(now())
   updatedAt         DateTime           @updatedAt
-  userInterests     UserInterests[]
+  userInterests     UserInterest[]
   postLike          PostLike[]
   commentLike       CommentLike[]
   pageView          PageView[]
   profileImage      String?
@@ -72,28 +72,28 @@
   authorId Int
 }
 model Post {
-  id         Int          @default(autoincrement()) @id
+  id         Int         @default(autoincrement()) @id
   title      String
   body       String
-  bodySrc    String       @default("")
+  bodySrc    String      @default("")
   excerpt    String
-  status     PostStatus   @default(DRAFT)
+  status     PostStatus  @default(DRAFT)
   images     Image[]
-  createdAt  DateTime     @default(now())
-  updatedAt  DateTime     @updatedAt
-  author     User         @relation(fields: [authorId], references: [id])
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  author     User        @relation(fields: [authorId], references: [id])
   authorId   Int
-  readTime   Int          @default(1)
+  readTime   Int         @default(1)
   likes      PostLike[]
-  topic      Topic[]      @relation(references: [id])
-  language   Language     @relation(fields: [languageId], references: [id])
+  topic      Topic[]     @relation(references: [id])
+  language   Language    @relation(fields: [languageId], references: [id])
   languageId Int
   longitude  Float?
   latitude   Float?
   threads    Thread[]
-  postTopics PostTopics[]
+  postTopics PostTopic[]
 }
 model Language {
   id            Int                @default(autoincrement()) @id
@@ -113,19 +113,19 @@
   User    User[]
 }
 model Topic {
-  id            Int             @default(autoincrement()) @id
+  id            Int            @default(autoincrement()) @id
   name          String
-  posts         Post[]          @relation(references: [id])
-  user          User?           @relation(fields: [userId], references: [id])
+  posts         Post[]         @relation(references: [id])
+  user          User?          @relation(fields: [userId], references: [id])
   userId        Int?
-  userInterests UserInterests[]
-  postTopics    PostTopics[]
+  userInterests UserInterest[]
+  postTopics    PostTopic[]
   prompt        Prompt[]
 }
-model UserInterests {
+model UserInterest {
   id        Int      @default(autoincrement()) @id
   user      User     @relation(fields: [userId], references: [id])
   userId    Int
   topic     Topic    @relation(fields: [topicId], references: [id])
@@ -134,9 +134,9 @@
   @@unique([userId, topicId])
 }
-model PostTopics {
+model PostTopic {
   id      Int   @default(autoincrement()) @id
   post    Post  @relation(fields: [postId], references: [id])
   postId  Int
   topic   Topic @relation(fields: [topicId], references: [id])
```
