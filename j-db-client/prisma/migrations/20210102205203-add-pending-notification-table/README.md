# Migration `20210102205203-add-pending-notification-table`

This migration has been generated by Ryan "Lanny" Jenkins at 1/2/2021, 2:52:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."NotificationType" AS ENUM ('THREAD_COMMENT', 'POST_COMMENT', 'THREAD_COMMENT_THANKS', 'POST_COMMENT_THANKS', 'NEW_POST')

CREATE TABLE "PendingNotification" (
"id" SERIAL,
    "type" "NotificationType" NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" INTEGER NOT NULL,
    "postId" INTEGER,
    "postCommentThanksId" INTEGER,
    "commentThanksId" INTEGER,
    "postCommentId" INTEGER,
    "commentId" INTEGER,

    PRIMARY KEY ("id")
)

ALTER TABLE "PendingNotification" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "PendingNotification" ADD FOREIGN KEY("postId")REFERENCES "Post"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "PendingNotification" ADD FOREIGN KEY("postCommentThanksId")REFERENCES "PostCommentThanks"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "PendingNotification" ADD FOREIGN KEY("commentThanksId")REFERENCES "CommentThanks"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "PendingNotification" ADD FOREIGN KEY("postCommentId")REFERENCES "PostComment"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "PendingNotification" ADD FOREIGN KEY("commentId")REFERENCES "Comment"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201228152243-add-published-language-level..20210102205203-add-pending-notification-table
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator prisma_client {
   provider = "prisma-client-js"
@@ -318,8 +318,27 @@
   @@unique([userId, type])
 }
+model PendingNotification {
+  id                  Int                @id @default(autoincrement())
+  type                NotificationType
+  createdAt           DateTime           @default(now())
+  user                User               @relation(fields: [userId], references: [id])
+  userId              Int
+
+  post                Post?              @relation(fields: [postId], references: [id])
+  postId              Int?
+  postCommentThanks   PostCommentThanks? @relation(fields: [postCommentThanksId], references: [id])
+  postCommentThanksId Int?
+  commentThanks       CommentThanks?     @relation(fields: [commentThanksId], references: [id])
+  commentThanksId     Int?
+  postComment         PostComment?       @relation(fields: [postCommentId], references: [id])
+  postCommentId       Int?
+  comment             Comment?           @relation(fields: [commentId], references: [id])
+  commentId           Int?
+}
+
 enum UserRole {
   ADMIN
   MODERATOR
   FREE_USER
@@ -347,4 +366,12 @@
   TEN_POSTS
   ONEHUNDRED_POSTS
   CODE_CONTRIBUTOR
 }
+
+enum NotificationType {
+  THREAD_COMMENT
+  POST_COMMENT
+  THREAD_COMMENT_THANKS
+  POST_COMMENT_THANKS
+  NEW_POST
+}
```


