# Migration `20201026144537-new-language-relation-model`

This migration has been generated by Robin MacPherson at 10/26/2020, 2:45:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "LanguageLevel" AS ENUM ('BEGINNER', 'INTERMEDIATE', 'ADVANCED', 'NATIVE');

CREATE TABLE "public"."LanguageRelation" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"languageId" integer  NOT NULL ,"level" "LanguageLevel" NOT NULL ,"userId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Post" ALTER COLUMN "status" SET DEFAULT 'DRAFT';

ALTER TABLE "public"."User" ALTER COLUMN "userRole" SET DEFAULT 'FREE_USER';

CREATE UNIQUE INDEX "LanguageRelation.userId_languageId" ON "public"."LanguageRelation"("userId","languageId")

ALTER TABLE "public"."LanguageRelation" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."LanguageRelation" ADD FOREIGN KEY ("languageId")REFERENCES "public"."Language"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201002152245-add-archived-field-to-threads..20201026144537-new-language-relation-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator prisma_client {
   provider = "prisma-client-js"
@@ -21,8 +21,9 @@
   location            Location?            @relation(fields: [locationId], references: [id])
   locationId          Int?
   languagesNative     LanguageNative[]
   languagesLearning   LanguageLearning[]
+  languages           LanguageRelation[]
   createdAt           DateTime             @default(now())
   updatedAt           DateTime             @updatedAt
   userInterests       UserInterest[]
   pageView            PageView[]
@@ -32,8 +33,10 @@
   commentThanks       CommentThanks[]
   postCommentThanks   PostCommentThanks[]
   comments            Comment[]
   postComments        PostComment[]
+  followedBy          User[]               @relation("UserFollows", references: [id])
+  following           User[]               @relation("UserFollows", references: [id])
 }
 model Auth {
   id               Int     @default(autoincrement()) @id
@@ -54,8 +57,26 @@
   @@unique([userId, languageId])
 }
+model LanguageRelation {
+  id         Int      @default(autoincrement()) @id
+  user       User     @relation(fields: [userId], references: [id])
+  userId     Int
+  language   Language @relation(fields: [languageId], references: [id])
+  languageId Int
+  createdAt  DateTime @default(now())
+  level      LanguageLevel
+  @@unique([userId, languageId])
+}
+
+enum LanguageLevel {
+  BEGINNER
+  INTERMEDIATE
+  ADVANCED
+  NATIVE
+}
+
 model LanguageNative {
   id         Int      @default(autoincrement()) @id
   user       User     @relation(fields: [userId], references: [id])
   userId     Int
```


